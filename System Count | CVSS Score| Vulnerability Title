WITH
    vuln AS(
        SELECT title, vulnerability_id, CAST(cvss_score AS NUMERIC)
            FROM dim_vulnerability
                WHERE cvss_score >= 4
    ),
    host AS(
        SELECT ip_address, asset_id
            FROM dim_asset
    ),
    summary AS(
        SELECT ip_address, asset_id, title, vulnerability_id, cvss_score
            FROM fact_asset_vulnerability_finding
                JOIN vuln USING (vulnerability_id)
                JOIN host USING (asset_id)
     )
SELECT COUNT(title) AS "System Count", ROUND(cvss_score,1) AS "CVSS Score", title AS "Vulnerability Title"
     FROM summary
        GROUP BY title, cvss_score
            ORDER BY title
